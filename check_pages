#!/usr/bin/env php
<?php

const ROOT = __DIR__;
require ROOT . '/vendor/autoload.php';

use AKlump\CheckPages\Command\RunCommand;
use Symfony\Component\Console\Application;
use Symfony\Component\DependencyInjection\Loader\YamlFileLoader;
use Symfony\Component\Config\FileLocator;
use Symfony\Component\DependencyInjection\ContainerBuilder;

global $container;
$container = new ContainerBuilder();
$loader = new YamlFileLoader($container, new FileLocator(ROOT));
$loader->load('services.DO_NOT_EDIT.yml');


$application = new Application();
$application->setName('Check Pages by In the Loft Studios');
$version = json_decode(file_get_contents(ROOT . '/composer.json'))->version ?? '';
$application->setVersion($version);
$application->add(new RunCommand());

// Expose commands to plugins via events.
foreach ($application->all() as $command) {
  // TODO setup an event for plugins to add options to a command.
  // @see \AKlump\CheckPages\Parts\Runner::getDispatcher()
  $command_name = $command->getName();
  if ('run' === $command_name) {
    $command->addOption('debug', NULL, \Symfony\Component\Console\Input\InputOption::VALUE_OPTIONAL);
  }
}

$application->run();
